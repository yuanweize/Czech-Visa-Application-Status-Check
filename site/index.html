<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Czech Republic Visa Monitor</title>
  <link rel="icon" type="image/png" href="assets/logo.png" />
  <link rel="stylesheet" href="assets/style.css" />
</head>

<body>
  <header>
    <h1>Czech Republic Visa Monitor</h1>
    <p class="subtitle">Real-time visa application status monitoring / ÂÆûÊó∂Á≠æËØÅÁî≥ËØ∑Áä∂ÊÄÅÁõëÊéß</p>
  </header>
  <main>
    <div class="toolbar">
      <div class="toolbar-left">
        <button id="refresh" disabled>
          <span class="btn-text">Refresh</span>
          <span class="spinner" style="display: none;">‚ü≥</span>
        </button>
        <div class="status-info">
          <span id="generatedAt"></span>
          <div id="countdown" class="countdown"></div>
        </div>
        <input id="filter" type="search" placeholder="Filter by code or status..." />
      </div>

      <!-- ÁÆ°ÁêÜÈù¢ÊùøÁßªÂä®Âà∞toolbarÂè≥‰æß -->
      <div class="management-panel">
        <button id="btn-add-code" class="btn-secondary">‚ûï Add New Code</button>
        <button id="btn-manage-codes" class="btn-secondary">üóëÔ∏è Manage My Codes</button>
      </div>
    </div>
    <div class="table-container">
      <table id="tbl">
        <thead>
          <tr>
            <th id="th-code" data-sort-key="code" class="sortable">
              Code <span class="sort-arrow" id="arrow-code">‚Üì</span>
            </th>
            <th id="th-status" data-sort-key="status" class="sortable">
              Status <span class="sort-arrow" id="arrow-status"></span>
            </th>
            <th>Check Status</th>
            <th>Last Changed</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="footer-main">
      <small>Updated from status.json ‚Ä¢ Auto-refreshes every 60 seconds</small>
    </div>
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
      <div class="loading-spinner">
        <div class="spinner-ring"></div>
        <p>Refreshing data...</p>
      </div>
    </div>

    <!-- Ê∑ªÂä†‰ª£Á†ÅÂºπÁ™ó -->
    <div id="modal-add" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h3>Add New Visa Code</h3>
        <form id="form-add-code">
          <div class="form-group">
            <label>Query Type / Êü•ËØ¢Á±ªÂûã</label>
            <div class="segmented-control">
              <input type="radio" name="query_type" id="type-zov" value="zov" checked
                onchange="toggleQueryTypeFields()">
              <label for="type-zov">≈ΩOV (Visa Application Number)</label>

              <input type="radio" name="query_type" id="type-oam" value="oam" onchange="toggleQueryTypeFields()">
              <label for="type-oam">OAM (Reference Number)</label>

              <div class="segmented-indicator"></div>
            </div>
          </div>

          <!-- ZOV Field -->
          <div id="zov-fields" class="form-group">
            <label>Visa Code / Á≠æËØÅ‰ª£Á†Å (≈ΩOV)</label>
            <input type="text" id="input-code" placeholder="e.g., PEKI202501010001" autocomplete="off" />
            <small>Format: 4 Letters + 12 Digits</small>
          </div>

          <!-- OAM Fields -->
          <div id="oam-fields" style="display:none;">
            <div class="form-group">
              <label>Serial Number / Â∫èÂàóÂè∑</label>
              <input type="text" id="oam-serial" placeholder="e.g., 12345" autocomplete="off" />
              <small>Numerical serial from your document</small>
            </div>
            <div class="form-group">
              <label>Suffix / ÂêéÁºÄ (Optional)</label>
              <input type="text" id="oam-suffix" placeholder="e.g., XX" autocomplete="off" />
              <small>Leave empty if no suffix</small>
            </div>
            <div class="form-row">
              <div class="form-group half">
                <label>Type / Á±ªÂûã</label>
                <select id="oam-type">
                  <option value="CC">CC</option>
                  <option value="CD">CD</option>
                  <option value="CA">CA</option>
                  <option value="CB">CB</option>
                </select>
              </div>
              <div class="form-group half">
                <label>Year / Âπ¥‰ªΩ</label>
                <select id="oam-year"></select>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label>Email for Notifications</label>
            <input type="email" id="input-email" placeholder="your@email.com" required />
            <small>We'll send status updates to this email</small>
          </div>
          <div class="form-group captcha">
            <label>Security Check</label>
            <div class="captcha-question">
              <span id="captcha-question">Please calculate: 3 + 7 = ?</span>
              <input type="number" id="captcha-answer" placeholder="Answer" required />
            </div>
          </div>
          <div class="form-actions">
            <button type="button" class="btn-secondary" onclick="closeModal('modal-add')">Cancel</button>
            <button type="submit" class="btn-primary">Submit Request</button>
          </div>
        </form>
        <div id="add-result" class="result-message" style="display:none;"></div>
      </div>
    </div>

    <!-- ÁÆ°ÁêÜ‰ª£Á†ÅÂºπÁ™ó -->
    <div id="modal-manage" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h3>Manage Your Codes</h3>
        <form id="form-verify-email">
          <div class="form-group">
            <label>Enter your email to view/delete your codes</label>
            <input type="email" id="verify-email" placeholder="your@email.com" required />
            <small>We'll send a verification code to this email</small>
          </div>
          <div class="form-group captcha">
            <label>Security Check</label>
            <div class="captcha-question">
              <span id="captcha-question-2">Please calculate: 5 + 2 = ?</span>
              <input type="number" id="captcha-answer-2" placeholder="Answer" required />
            </div>
          </div>
          <button type="submit" class="btn-primary">Send Verification Code</button>
        </form>

        <div id="verification-step" style="display:none;">
          <div class="form-group">
            <label>Enter the 6-digit code from your email</label>
            <input type="text" id="verification-code" placeholder="123456" maxlength="6" />
          </div>
          <button type="button" class="btn-primary" onclick="verifyAndShowCodes()">Verify & Show My Codes</button>
        </div>

        <div id="codes-list" style="display:none;">
          <h4>Your Monitored Codes</h4>
          <div id="user-codes-container"></div>
        </div>

        <div id="logout-section" style="display:none;">
          <div class="form-group">
            <button type="button" class="btn-secondary" onclick="logout()">Logout</button>
            <small>You'll stay logged in for 7 days unless you logout manually</small>
          </div>
        </div>

        <div id="manage-result" class="result-message" style="display:none;"></div>
      </div>
    </div>
  </main>
  <footer>
    <div class="footer">
      <div class="footer-line footer-line-1">Performance &amp; security by <strong>EURUN CDN</strong> ‚Ä¢ Operated by
        <strong>HKTSE s.r.o.</strong></div>
      <div class="footer-line footer-line-2">Holandsk√° 49/4, 10100 Praha, Czech Republic ‚Ä¢ Contact: <a
          href="mailto:info@hktse.eu.org">info@hktse.eu.org</a></div>
    </div>
  </footer>
  <script src="assets/app.js"></script>
</body>

</html>