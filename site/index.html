<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Czech Republic Visa Monitor</title>
  <link rel="icon" type="image/png" href="assets/logo.png" />
  <link rel="stylesheet" href="assets/style.css" />
</head>

<body>
  <header>
    <h1>Czech Republic Visa Monitor</h1>
    <p class="subtitle">Real-time visa application status monitoring / å®æ—¶ç­¾è¯ç”³è¯·çŠ¶æ€ç›‘æ§</p>
  </header>
  <main>
    <div class="toolbar">
      <div class="toolbar-left">
        <button id="refresh" disabled>
          <span class="btn-text">ğŸ”„ Refresh</span>
          <span class="spinner" style="display: none;">âŸ³</span>
        </button>
        <div class="status-info">
          <span id="generatedAt"></span>
          <div id="countdown" class="countdown"></div>
        </div>
        <input id="filter" type="search" placeholder="ğŸ” Filter by code or status..." />
      </div>

      <!-- ç®¡ç†é¢æ¿ç§»åŠ¨åˆ°toolbarå³ä¾§ -->
      <div class="management-panel">
        <button id="btn-add-code" class="btn-secondary">â• Add Code</button>
        <button id="btn-manage-codes" class="btn-secondary">âš™ï¸ Manage</button>
      </div>
    </div>
    <div class="table-container">
      <table id="tbl">
        <thead>
          <tr>
            <th id="th-code" data-sort-key="code" class="sortable">
              Code <span class="sort-arrow" id="arrow-code">â†“</span>
            </th>
            <th id="th-status" data-sort-key="status" class="sortable">
              Status <span class="sort-arrow" id="arrow-status"></span>
            </th>
            <th>Check Status</th>
            <th>Last Changed</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="footer-main">
      <small>Updated from status.json â€¢ Auto-refreshes every 60 seconds</small>
    </div>
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
      <div class="loading-spinner">
        <div class="spinner-ring"></div>
        <p>Refreshing data...</p>
      </div>
    </div>

    <!-- æ·»åŠ ä»£ç å¼¹çª— -->
    <div id="modal-add" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h3>Add New Visa Code</h3>
        <form id="form-add-code">
          <div class="form-group">
            <label>Query Type / æŸ¥è¯¢ç±»å‹</label>
            <div class="segmented-control">
              <input type="radio" name="query_type" id="type-zov" value="zov" checked>
              <label for="type-zov">Å½OV</label>

              <input type="radio" name="query_type" id="type-oam" value="oam">
              <label for="type-oam">OAM</label>
            </div>
          </div>

          <!-- Query Type Info -->
          <div id="query-type-info" class="query-type-info">
            <span class="icon">ğŸ“‹</span>
            <span class="text" id="query-type-description">Å½OV (Visa Application Number) - Standard visa application code from the embassy</span>
          </div>

          <!-- ZOV Field -->
          <div id="zov-fields" class="form-group">
            <label id="code-label">Visa Application Number / ç­¾è¯ç”³è¯·å· (Å½OV)</label>
            <input type="text" id="input-code" placeholder="e.g., PEKI202501010001" autocomplete="off" />
            <small id="code-hint">Format: 4 Letters + 12 Digits (e.g., PEKI202501010001)</small>
          </div>

          <!-- OAM Fields -->
          <div id="oam-fields" style="display:none;">
            <div class="form-group">
              <label>Serial Number / åºåˆ—å· (OAM)</label>
              <input type="text" id="oam-serial" placeholder="e.g., 12345" autocomplete="off" />
              <small>The numerical serial number from your residence permit document</small>
            </div>
            <div class="form-group">
              <label>Suffix / åç¼€ (Optional)</label>
              <input type="text" id="oam-suffix" placeholder="e.g., XX" autocomplete="off" />
              <small>Leave empty if your reference number has no suffix</small>
            </div>
            <div class="form-row">
              <div class="form-group half">
                <label>Type / ç±»å‹</label>
                <select id="oam-type">
                  <option value="CC">CC - Long-term Residence</option>
                  <option value="CD">CD - Permanent Residence</option>
                  <option value="CA">CA - Employee Card</option>
                  <option value="CB">CB - Blue Card</option>
                </select>
              </div>
              <div class="form-group half">
                <label>Year / å¹´ä»½</label>
                <select id="oam-year"></select>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label>ğŸ“§ Email for Notifications</label>
            <input type="email" id="input-email" placeholder="your@email.com" required />
            <small>We'll send status change notifications to this email</small>
          </div>
          <div class="form-group captcha">
            <label>ğŸ”’ Security Check</label>
            <div class="captcha-question">
              <span id="captcha-question">Please calculate: 3 + 7 = ?</span>
              <input type="number" id="captcha-answer" placeholder="?" required />
            </div>
          </div>
          <div class="form-actions">
            <button type="button" class="btn-secondary" onclick="closeModal('modal-add')">Cancel</button>
            <button type="submit" class="btn-primary">ğŸ“¤ Submit Request</button>
          </div>
        </form>
        <div id="add-result" class="result-message" style="display:none;"></div>
      </div>
    </div>

    <!-- ç®¡ç†ä»£ç å¼¹çª— -->
    <div id="modal-manage" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h3>ğŸ” Manage Your Codes</h3>
        <form id="form-verify-email">
          <div class="form-group">
            <label>ğŸ“§ Your Email Address</label>
            <input type="email" id="verify-email" placeholder="your@email.com" required />
            <small>Enter the email you used when adding codes. We'll send a verification code.</small>
          </div>
          <div class="form-group captcha">
            <label>ğŸ”’ Security Check</label>
            <div class="captcha-question">
              <span id="captcha-question-2">Please calculate: 5 + 2 = ?</span>
              <input type="number" id="captcha-answer-2" placeholder="?" required />
            </div>
          </div>
          <button type="submit" class="btn-primary" style="width:100%;">ğŸ“¤ Send Verification Code</button>
        </form>

        <div id="verification-step" style="display:none;">
          <div class="form-group">
            <label>ğŸ”‘ Enter Verification Code</label>
            <input type="text" id="verification-code" placeholder="123456" maxlength="6" />
            <small>Enter the 6-digit code sent to your email</small>
          </div>
          <button type="button" class="btn-primary" style="width:100%;" onclick="verifyAndShowCodes()">âœ“ Verify & Show My Codes</button>
        </div>

        <div id="codes-list" style="display:none;">
          <h4>ğŸ“‹ Your Monitored Codes</h4>
          <div id="user-codes-container"></div>
        </div>

        <div id="logout-section" style="display:none;">
          <div class="form-group">
            <button type="button" class="btn-secondary" style="width:100%;" onclick="logout()">ğŸšª Logout</button>
            <small>Your session will be remembered for 7 days unless you logout</small>
          </div>
        </div>

        <div id="manage-result" class="result-message" style="display:none;"></div>
      </div>
    </div>
  </main>
  <footer>
    <div class="footer">
      <div class="footer-line footer-line-1">Performance &amp; security by <strong>EURUN CDN</strong> â€¢ Operated by
        <strong>HKTSE s.r.o.</strong>
      </div>
      <div class="footer-line footer-line-2">HolandskÃ¡ 49/4, 10100 Praha, Czech Republic â€¢ Contact: <a
          href="mailto:info@hktse.eu.org">info@hktse.eu.org</a></div>
    </div>
  </footer>
  <script src="assets/app.js"></script>
</body>

</html>